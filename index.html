<!--
    This is a demo of AnyStock http://www.anychart.com/products/anystock/ Charts Feature: Drawing Tools / Annotations
    Documentation: http://docs.anychart.com/latest/Stock_Charts/Overview
    API: https://api.anychart.com/latest/anychart.charts.Stock
    Support: http://www.anychart.com/support/
    Contacts: http://www.anychart.com/company/
    
    http://www.anychart.com/
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <meta name="description" content="AnyStock offers a large set of features that allow you to build your online financial portal and one of the most exciting features is the ability to draw/display on the chart so called drawing tools or, as they are called in our documentation documentation and settings, annotations.">
    <meta name="keywords" content="AnyChart,AnyStock,Annotation,Drawing Tools,Technical Analysis,Security Analysis">
    <meta name="author" content="anychart.com">

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>AnyStock - Drawing Tools and Annotations Demo</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- AnyChart UI -->
    <link rel="stylesheet" href="https://cdn.anychart.com/css/7.11.0/anychart-ui.min.css">
    <link rel="stylesheet" href="https://cdn.anychart.com/fonts/2.0.0/anychart.css">

    <!-- ColorPicker -->
    <link href="./css/bootstrap-colorpicker.min.css" rel="stylesheet">
    <link href="./css/bootstrap-colorpicker-plus.min.css" rel="stylesheet">
    <style>
        .color-fill-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 1px solid #000;
            background-color: #fff;
            margin: 2px;
        }

        .colorpickerplus-custom-colors,
        .colorpickerplus .input-group {
            display: none;
        }

        .dropdown-color-fill-icon {
            position: relative;
            float: left;
            margin-left: 0;
            margin-right: 0
        }

        body {
            min-width: 782px;
        }

        #chart-container {
            position: absolute;
            top: 52px;
            bottom: 0;
            left: 0;
            right: 0;
        }

        * {
            outline: none !important;
        }
    </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="toolbar">
    <div class="btn-group">
        <button type="button" class="btn btn-default" id="color-picker"><span class="color-fill-icon dropdown-color-fill-icon" style="background-color:#e06666;"></span>&nbsp;<b class="caret"></b></button>
    </div>

    <div class="btn-group">
        <button data-annotation-type="line" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-line" aria-hidden="true"></i></button>
        <button data-annotation-type="horizontalLine" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-horizontal-line" aria-hidden="true"></i></button>
        <button data-annotation-type="verticalLine" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-vertical-line" aria-hidden="true"></i></button>
        <button data-annotation-type="infiniteLine" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-infinite-line" aria-hidden="true"></i></button>
        <button data-annotation-type="ray" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-ray" aria-hidden="true"></i></button>
    </div>

    <div class="btn-group">
        <button data-annotation-type="triangle" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-triangle" aria-hidden="true"></i></button>
        <button data-annotation-type="rectangle" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-rectangle" aria-hidden="true"></i></button>
        <button data-annotation-type="ellipse" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-ellipse" aria-hidden="true"></i></button>
    </div>

    <div class="btn-group">
        <button data-annotation-type="trendChannel" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-trend-channel" aria-hidden="true"></i></button>
        <button data-annotation-type="andrewsPitchfork" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-andrews-pitchfork" aria-hidden="true"></i></button>
    </div>

    <div class="btn-group">
        <button data-annotation-type="fibonacciFan" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-fibonacci-fan" aria-hidden="true"></i></button>
        <button data-annotation-type="fibonacciArc" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-fibonacci-arc" aria-hidden="true"></i></button>
        <button data-annotation-type="fibonacciRetracement" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-fibonacci-retracement" aria-hidden="true"></i></button>
        <button data-annotation-type="fibonacciTimezones" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-fibonacci-timezones" aria-hidden="true"></i></button>
    </div>

    <div class="btn-group">
        <button data-annotation-type="marker" data-marker-type="arrowUp" data-marker-anchor="top" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-arrow-up-square" aria-hidden="true"></i></button>
        <button data-annotation-type="marker" data-marker-type="arrowDown" data-marker-anchor="bottom" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-arrow-down-square" aria-hidden="true"></i></button>
        <button data-annotation-type="marker" data-marker-type="arrowLeft" data-marker-anchor="left" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-arrow-left-square" aria-hidden="true"></i></button>
        <button data-annotation-type="marker" data-marker-type="arrowRight" data-marker-anchor="right" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-arrow-right-square" aria-hidden="true"></i></button>
    </div>

    <div class="btn-group">
        <button data-action-type="removeAllAnnotations" type="button" class="btn btn-default" aria-label="Center Align"><i class="ac ac-remove-thin" aria-hidden="true"></i></button>
    </div>
</div>
<div id="chart-container"></div>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./js/bootstrap.min.js"></script>
<script src="./js/bootstrap-colorpicker.min.js"></script>
<script src="./js/bootstrap-colorpicker-plus.js"></script>
<script src="https://cdn.anychart.com/js/7.11.0/anychart-bundle.min.js"></script>
<script src="https://cdn.anychart.com/csv-data/msft-daily-short.js"></script>

<script>
    var chart;
    var annotationsColor;
    $(function() {
        // page UI elements
        createPageColorPicker();

        // data from https://cdn.anychart.com/csv-data/msft-daily-short.js
        var data = get_msft_daily_short_data();

        // Create new chart object.
        chart = anychart.stock();

        // create data table
        var table = anychart.data.table(0);
        table.addData(data);

        // create data mappings
        var mapping = table.mapAs({value: 4});

        // create line series
        chart.plot(0).line(mapping)
                .stroke("2 #253992")
                .name("MSFT");

        // create ema indicator
        chart.plot(0).ema(mapping, 50, "spline")
                .series()
                .stroke("#DB2A0E");

        // create scroller series
        chart.scroller().area(mapping)
                .color("#253992 0.3")
                .stroke("#253992");

        // set grid and axis settings
        chart.plot(0).yAxis(0).orientation("right");
        chart.plot(0).yAxis(1)
                .orientation("left")
                .ticks(false)
                .labels(false)
                .minorLabels(false);
        chart.plot(0).grid(0).layout("h");
        chart.plot(0).grid(1).layout("v");

        // set chart padding
        chart.padding(5, 30, 5, 5);

        // add annotation items in context menu
        chart.contextMenu().itemsFormatter(contextMenuItemsFormatter);

        // use annotation events to update application UI elements
        chart.listen("annotationDrawingFinish", onAnnotationDrawingFinish);
        chart.listen("annotationSelect", onAnnotationSelect);

        // set container id for the chart
        chart.container("chart-container");

        // initiate chart drawing
        chart.draw();

        $('.btn[data-annotation-type]').click(function(evt) {
            var $target = $(evt.currentTarget);
            var active = $target.hasClass('active');
            if (active) {
                chart.annotations().cancelDrawing();
                setToolbarButtonActive(null);
            } else {
                var type = $target.attr('data-annotation-type');
                var markerType = $target.attr('data-marker-type');
                setToolbarButtonActive(type, markerType);
                if (type) {
                    var markerAnchor = $target.attr('data-marker-anchor');
                    var drawingSettings = {
                        type: type,
                        color: annotationsColor,
                        markerType: markerType,
                        anchor: markerAnchor

                    };
                    chart.annotations().startDrawing(drawingSettings);
                }
            }
        });


        $('.btn[data-action-type]').click(function(evt) {
            var $target = $(evt.currentTarget);
            $target.blur();
            var type = $target.attr('data-action-type');
            switch (type) {
                case 'removeAllAnnotations':
                    removeAllAnnotation();
                    break;
            }
        });

        $('html').keyup(function(e) {
            if (e.keyCode == 8) {
                removeSelectedAnnotation();
            }
        })
    });

    function createPageColorPicker() {
        // color picker
        var colorPicker = $('#color-picker');
        colorPicker.colorpickerplus();
        colorPicker.on('changeColor', function(e, color) {
            // set default color for annotations using global theme
            annotationsColor = color;

            // update color of selected annotation if any
            var annotation = chart.annotations().getSelectedAnnotation();
            if (annotation) annotation.color(color);

            if (color == null) {
                $('.color-fill-icon', $(this)).addClass('colorpicker-color');
            } else {
                $('.color-fill-icon', $(this)).removeClass('colorpicker-color');
                $('.color-fill-icon', $(this)).css('background-color', color);
            }
        });
    }


    function removeSelectedAnnotation() {
        var annotation = chart.annotations().getSelectedAnnotation();
        if (annotation) chart.annotations().removeAnnotation(annotation);
        return !!annotation;
    }

    function removeAllAnnotation() {
        chart.annotations().removeAllAnnotations();
    }


    function onAnnotationDrawingFinish() {
        setToolbarButtonActive(null);
    }

    function onAnnotationSelect(evt) {
        var annotation = evt.annotation;
        var color = annotation.color();
        $('#color-picker .color-fill-icon').css('background-color', color);
    }

    function contextMenuItemsFormatter(items) {
        // insert context menu item on 0 position
        items.splice(0, 0, {
            text: "Remove selected annotation",
            action: removeSelectedAnnotation
        });

        // insert context menu item on 1 position
        items.splice(1, 0, {
            text: "Remove all annotations",
            action: removeAllAnnotation
        });

        // insert context menu separator
        items.splice(2, 0, undefined);

        return items;
    }

    function setToolbarButtonActive(type, markerType) {
        var $buttons = $('.btn[data-annotation-type]');
        $buttons.removeClass('active');
        $buttons.blur();

        if (type) {
            var selector = '.btn[data-annotation-type="' + type + '"]';
            if (markerType) selector += '[data-marker-type="' + markerType + '"]';
            $(selector).addClass('active');
        }
    }
</script>
</body>
</html>
